<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Rápido - localStorage</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { padding: 15px 30px; margin: 10px; background: #007cba; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #005a87; }
        #resultado { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        .ok { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Test Rápido localStorage</h1>
        <p>Haz clic en "EJECUTAR TEST" y copia el resultado aquí:</p>
        
        <button onclick="ejecutarTest()">🚀 EJECUTAR TEST</button>
        
        <div id="resultado"></div>
    </div>

    <script>
        function ejecutarTest() {
            const resultado = document.getElementById('resultado');
            let reporte = '';
            
            // === TEST 1: localStorage disponible ===
            try {
                if (typeof(Storage) === "undefined") {
                    reporte += '❌ localStorage NO disponible\n';
                } else {
                    reporte += '✅ localStorage disponible\n';
                }
            } catch (e) {
                reporte += '❌ Error verificando localStorage: ' + e.message + '\n';
            }
            
            // === TEST 2: Escribir y leer ===
            try {
                const testKey = 'test_' + Date.now();
                const testValue = 'valor_' + Math.random();
                
                localStorage.setItem(testKey, testValue);
                const leido = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                
                if (leido === testValue) {
                    reporte += '✅ Escribir/leer funciona\n';
                } else {
                    reporte += '❌ Escribir/leer NO funciona\n';
                }
            } catch (e) {
                reporte += '❌ Error en escribir/leer: ' + e.message + '\n';
            }
            
            // === TEST 3: JSON ===
            try {
                const testData = { nombre: 'test', numero: 123, fecha: new Date().toISOString() };
                localStorage.setItem('test_json', JSON.stringify(testData));
                const leido = JSON.parse(localStorage.getItem('test_json'));
                localStorage.removeItem('test_json');
                
                if (leido.nombre === testData.nombre) {
                    reporte += '✅ JSON funciona\n';
                } else {
                    reporte += '❌ JSON NO funciona\n';
                }
            } catch (e) {
                reporte += '❌ Error en JSON: ' + e.message + '\n';
            }
            
            // === TEST 4: POIs actuales ===
            try {
                const pois = localStorage.getItem('puerres_map_pois');
                if (pois) {
                    const parsed = JSON.parse(pois);
                    reporte += '✅ POIs encontrados: ' + parsed.length + '\n';
                    reporte += '📋 POIs: ' + parsed.map(p => p.name || 'Sin nombre').join(', ') + '\n';
                } else {
                    reporte += '⚠️ No hay POIs guardados\n';
                }
            } catch (e) {
                reporte += '❌ Error leyendo POIs: ' + e.message + '\n';
            }
            
            // === TEST 5: Agregar POI de prueba ===
            try {
                const nuevoPOI = {
                    id: 'test_' + Date.now(),
                    name: 'POI de Prueba',
                    coords: [0.883000, -77.504000],
                    whatsapp: '3009999999',
                    icon: 'fas fa-star',
                    color: '#ff0000'
                };
                
                const poisExistentes = localStorage.getItem('puerres_map_pois');
                let pois = poisExistentes ? JSON.parse(poisExistentes) : [];
                pois.push(nuevoPOI);
                
                localStorage.setItem('puerres_map_pois', JSON.stringify(pois));
                
                // Verificar que se guardó
                const verificar = localStorage.getItem('puerres_map_pois');
                const verificarParsed = JSON.parse(verificar);
                const encontrado = verificarParsed.find(p => p.id === nuevoPOI.id);
                
                if (encontrado) {
                    reporte += '✅ Agregar POI funciona\n';
                } else {
                    reporte += '❌ Agregar POI NO funciona\n';
                }
                
                // Limpiar POI de prueba
                const poisLimpios = verificarParsed.filter(p => p.id !== nuevoPOI.id);
                localStorage.setItem('puerres_map_pois', JSON.stringify(poisLimpios));
                
            } catch (e) {
                reporte += '❌ Error agregando POI: ' + e.message + '\n';
            }
            
            // === TEST 6: Información del navegador ===
            reporte += '\n📱 Navegador: ' + navigator.userAgent.split(' ')[0] + '\n';
            reporte += '🌐 URL: ' + window.location.href + '\n';
            reporte += '⏰ Fecha: ' + new Date().toLocaleString() + '\n';
            
            // Mostrar resultado
            resultado.innerHTML = reporte;
            resultado.style.display = 'block';
            
            // Copiar al portapapeles
            navigator.clipboard.writeText(reporte).then(() => {
                resultado.innerHTML += '\n\n📋 ¡Resultado copiado al portapapeles!';
            }).catch(() => {
                resultado.innerHTML += '\n\n📋 Copia manualmente el texto de arriba';
            });
        }
    </script>
</body>
</html>
